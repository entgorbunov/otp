databaseChangeLog:
  - changeSet:
      id: "01.create_otp_tables.yml"
      author: "Gorbunov AV"
      changes:
        - createTable:
            ifNotExists: true
            tableName: send_otp
            remarks: "Информация о сгенерированном пароле и статусе его отправки"
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: process_id
                  type: varchar
                  remarks: "Идентификатор процесса"
                  constraints:
                    nullable: false
              - column:
                  name: telegram_chat_id
                  type: varchar
                  remarks: "Идентификатор телеграм чата"
                  constraints:
                    nullable: false
              - column:
                  name: message
                  type: varchar(1000)
                  remarks: "Текст сообщения"
                  constraints:
                    nullable: false
              - column:
                  name: length
                  type: int
                  remarks: "Длина одноразового пароля"
                  constraints:
                    nullable: false
              - column:
                  name: ttl
                  type: int
                  remarks: "Время жизни одноразового пароля в секундах"
                  constraints:
                    nullable: false
              - column:
                  name: resend_attempts
                  type: int
                  remarks: "Количество возможных повторных отправок кода"
                  constraints:
                    nullable: false
              - column:
                  name: resend_timeout
                  type: int
                  remarks: "Таймаут перед повторным запросом кода в секундах"
                  constraints:
                    nullable: false
              - column:
                  name: salt
                  type: varchar
                  remarks: "Соль одноразового пароля"
                  constraints:
                    nullable: false
              - column:
                  name: send_message_key
                  type: varchar
                  remarks: "Идентификатор сообщения"
              - column:
                  name: status
                  type: varchar(20)
                  remarks: "Статус отправки сообщения"
                  constraints:
                    nullable: false
              - column:
                  name: send_time
                  type: timestamp
                  remarks: "Время отправки одноразового пароля"
              - column:
                  name: create_time
                  type: timestamp
                  remarks: "Время создания"
                  constraints:
                    nullable: false
              - column:
                  name: create_user
                  type: varchar
                  remarks: "Пользователь, создавший запись"
                  constraints:
                    nullable: false
              - column:
                  name: last_update_time
                  type: timestamp
                  remarks: "Время последнего изменения"
                  constraints:
                    nullable: false
              - column:
                  name: last_update_user
                  type: varchar
                  remarks: "Пользователь, изменивший запись"
                  constraints:
                    nullable: false

        - createTable:
            ifNotExists: true
            tableName: check_otp
            remarks: "Данные о проверке одноразового пароля"
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: process_id
                  type: varchar
                  remarks: "Идентификатор процесса"
                  constraints:
                    nullable: false
              - column:
                  name: otp
                  type: varchar
                  remarks: "Введенный клиентом код"
                  constraints:
                    nullable: false
              - column:
                  name: check_time
                  type: timestamp
                  remarks: "Время проверки"
                  constraints:
                    nullable: false
              - column:
                  name: correct
                  type: boolean
                  remarks: "Признак корректности введенного пароля"
                  constraints:
                    nullable: false
              - column:
                  name: create_time
                  type: timestamp
                  remarks: "Время создания"
                  constraints:
                    nullable: false
              - column:
                  name: create_user
                  type: varchar
                  remarks: "Пользователь, создавший запись"
                  constraints:
                    nullable: false
              - column:
                  name: last_update_time
                  type: timestamp
                  remarks: "Время последнего изменения"
                  constraints:
                    nullable: false
              - column:
                  name: last_update_user
                  type: varchar
                  remarks: "Пользователь, изменивший запись"
                  constraints:
                    nullable: false

        - createIndex:
            indexName: idx_send_otp_process_id
            tableName: send_otp
            columns:
              - column:
                  name: process_id

        - createIndex:
            indexName: idx_check_otp_process_id
            tableName: check_otp
            columns:
              - column:
                  name: process_id
